============================= test session starts ==============================
platform linux -- Python 3.10.18, pytest-8.3.5, pluggy-1.5.0 -- /usr/bin/python3
cachedir: .pytest_cache
metadata: {'Python': '3.10.18', 'Platform': 'Linux-6.8.0-x86_64-with-glibc2.39', 'Packages': {'pytest': '8.3.5', 'pluggy': '1.5.0'}, 'Plugins': {'anyio': '4.9.0', 'cov': '6.1.1', 'json-report': '1.5.0', 'metadata': '3.1.1'}}
rootdir: /app
plugins: anyio-4.9.0, cov-6.1.1, json-report-1.5.0, metadata-3.1.1
collecting ... collected 65 items

reporter/tests/test_book_closing.py::test_close_and_reopen_flow PASSED   [  1%]
reporter/tests/test_book_closing.py::test_add_transaction_to_closed_month FAILED [  3%]
reporter/tests/test_book_closing.py::test_delete_transaction_from_closed_month FAILED [  4%]
reporter/tests/test_database.py::test_create_database_tables PASSED      [  6%]
reporter/tests/test_database.py::test_seed_initial_plans PASSED          [  7%]
reporter/tests/test_database_manager.py::test_add_member_successful PASSED [  9%]
reporter/tests/test_database_manager.py::test_add_member_duplicate_phone PASSED [ 10%]
reporter/tests/test_database_manager.py::test_get_all_members_empty PASSED [ 12%]
reporter/tests/test_database_manager.py::test_get_all_members_multiple PASSED [ 13%]
reporter/tests/test_database_manager.py::test_get_all_members_filter_by_name PASSED [ 15%]
reporter/tests/test_database_manager.py::test_get_all_members_filter_by_phone PASSED [ 16%]
reporter/tests/test_database_manager.py::test_get_all_members_filter_by_name_and_phone PASSED [ 18%]
reporter/tests/test_database_manager.py::test_get_all_plans PASSED       [ 20%]
reporter/tests/test_database_manager.py::test_get_all_plans_no_plans PASSED [ 21%]
reporter/tests/test_database_manager.py::test_get_all_plans_with_inactive_no_plans PASSED [ 23%]
reporter/tests/test_database_manager.py::test_get_all_plans_with_inactive_only_active PASSED [ 24%]
reporter/tests/test_database_manager.py::test_get_all_plans_with_inactive_only_inactive PASSED [ 26%]
reporter/tests/test_database_manager.py::test_get_all_plans_with_inactive_mixed PASSED [ 27%]
reporter/tests/test_database_manager.py::test_get_plan_by_name_and_duration_exists PASSED [ 29%]
reporter/tests/test_database_manager.py::test_get_plan_by_name_and_duration_not_exists PASSED [ 30%]
reporter/tests/test_database_manager.py::test_get_plan_by_name_and_duration_wrong_duration PASSED [ 32%]
reporter/tests/test_database_manager.py::test_get_or_create_plan_id_get_existing PASSED [ 33%]
reporter/tests/test_database_manager.py::test_get_or_create_plan_id_create_new PASSED [ 35%]
reporter/tests/test_database_manager.py::test_add_transaction_group_class PASSED [ 36%]
reporter/tests/test_database_manager.py::test_get_memberships_for_member_none PASSED [ 38%]
reporter/tests/test_database_manager.py::test_add_transaction_group_class_invalid_plan_id PASSED [ 40%]
reporter/tests/test_database_manager.py::test_add_transaction_personal_training PASSED [ 41%]
reporter/tests/test_database_manager.py::test_get_all_activity_for_member PASSED [ 43%]
reporter/tests/test_database_manager.py::test_get_pending_renewals PASSED [ 44%]
reporter/tests/test_database_manager.py::test_get_pending_renewals_none_when_no_relevant_data PASSED [ 46%]
reporter/tests/test_database_manager.py::test_get_finance_report PASSED  [ 47%]
reporter/tests/test_database_manager.py::test_get_finance_report_no_transactions PASSED [ 49%]
reporter/tests/test_database_manager.py::test_get_finance_report_with_pt_bookings PASSED [ 50%]
reporter/tests/test_database_manager.py::test_join_date_standardization_new_member_then_group_membership PASSED [ 52%]
reporter/tests/test_database_manager.py::test_join_date_standardization_new_member_then_pt_booking PASSED [ 53%]
reporter/tests/test_database_manager.py::test_join_date_standardization_existing_member_earlier_activity PASSED [ 55%]
reporter/tests/test_database_manager.py::test_join_date_standardization_existing_member_later_activity PASSED [ 56%]
reporter/tests/test_database_manager.py::test_deactivate_member FAILED   [ 58%]
reporter/tests/test_database_manager.py::test_delete_transaction PASSED  [ 60%]
reporter/tests/test_database_manager.py::test_delete_plan PASSED         [ 61%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_no_filters PASSED [ 63%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_name_filter PASSED [ 64%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_phone_filter PASSED [ 66%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_join_date_filter PASSED [ 67%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_combined_filters PASSED [ 69%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_invalid_date_format_filter PASSED [ 70%]
reporter/tests/test_database_manager.py::test_get_transactions_with_member_details_no_results PASSED [ 72%]
reporter/tests/test_database_manager.py::test_get_book_status_non_existent PASSED [ 73%]
reporter/tests/test_database_manager.py::test_set_and_get_book_status_closed PASSED [ 75%]
reporter/tests/test_database_manager.py::test_set_and_get_book_status_open PASSED [ 76%]
reporter/tests/test_database_manager.py::test_set_book_status_update_existing PASSED [ 78%]
reporter/tests/test_database_manager.py::test_add_transaction_when_books_closed PASSED [ 80%]
reporter/tests/test_database_manager.py::test_delete_transaction_when_books_closed PASSED [ 81%]
reporter/tests/test_database_manager.py::test_add_transaction_when_books_open PASSED [ 83%]
reporter/tests/test_database_manager.py::test_delete_transaction_when_books_open PASSED [ 84%]
reporter/tests/test_gui_flows.py::test_add_member_flow FAILED            [ 86%]
reporter/tests/test_gui_flows.py::test_plan_management_flow FAILED       [ 87%]
reporter/tests/test_gui_flows.py::test_add_membership_flow PASSED        [ 89%]
reporter/tests/test_gui_flows.py::test_deactivate_member_action_flow PASSED [ 90%]
reporter/tests/test_gui_flows.py::test_delete_transaction_action_flow PASSED [ 92%]
reporter/tests/test_gui_flows.py::test_delete_plan_action_flow PASSED    [ 93%]
reporter/tests/test_gui_flows.py::test_generate_custom_pending_renewals_action_flow PASSED [ 95%]
reporter/tests/test_gui_flows.py::test_generate_finance_report_excel_action_flow PASSED [ 96%]
reporter/tests/test_migrate_data.py::test_migration_clears_tables PASSED [ 98%]
reporter/tests/test_migrate_data.py::test_end_date_calculation_and_record_processing PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_add_transaction_to_closed_month _____________________
reporter/tests/test_book_closing.py:161: in test_add_transaction_to_closed_month
    assert add_success_reopened is True
E   assert False is True
----------------------------- Captured stderr call -----------------------------
Failed: Books for month 2026-03 are closed.
Database error while adding transaction: Error binding parameter 0 - probably unsupported type.
__________________ test_delete_transaction_from_closed_month ___________________
reporter/tests/test_book_closing.py:194: in test_delete_transaction_from_closed_month
    assert add_tx_success is True, "Failed to add initial transaction for deletion test."
E   AssertionError: Failed to add initial transaction for deletion test.
E   assert False is True
----------------------------- Captured stderr call -----------------------------
Database error while adding transaction: Error binding parameter 0 - probably unsupported type.
____________________________ test_deactivate_member ____________________________
reporter/tests/test_database_manager.py:1147: in test_deactivate_member
    assert success_deactivate is True, "deactivate_member should return True on success."
E   AssertionError: deactivate_member should return True on success.
E   assert (True, 'Member deactivated successfully.') is True
---------------------------- Captured stdout setup -----------------------------
Database 'reporter/tests/test_data_dir/test_kranos_data.db' created and tables ensured.
Seeded 3 initial plans.
_____________________________ test_add_member_flow _____________________________
reporter/tests/test_gui_flows.py:66: in test_add_member_flow
    assert message == "Member added successfully! Join date will be set with first activity."
E   AssertionError: assert 'Member added successfully.' == 'Member added...rst activity.'
E
E     - Member added successfully! Join date will be set with first activity.
E     + Member added successfully.
---------------------------- Captured stdout setup -----------------------------
Database '/app/test_gui_flows.db' created and tables ensured.
--------------------------- Captured stdout teardown ---------------------------
Tearing down, removing /app/test_gui_flows.db
__________________________ test_plan_management_flow ___________________________
reporter/tests/test_gui_flows.py:91: in test_plan_management_flow
    assert message_add == "Plan added successfully!"
E   AssertionError: assert 'Plan added successfully.' == 'Plan added successfully!'
E
E     - Plan added successfully!
E     ?                        ^
E     + Plan added successfully.
E     ?                        ^
---------------------------- Captured stdout setup -----------------------------
Database '/app/test_gui_flows.db' created and tables ensured.
--------------------------- Captured stdout teardown ---------------------------
Tearing down, removing /app/test_gui_flows.db
=========================== short test summary info ============================
FAILED reporter/tests/test_book_closing.py::test_add_transaction_to_closed_month
FAILED reporter/tests/test_book_closing.py::test_delete_transaction_from_closed_month
FAILED reporter/tests/test_database_manager.py::test_deactivate_member - Asse...
FAILED reporter/tests/test_gui_flows.py::test_add_member_flow - AssertionErro...
FAILED reporter/tests/test_gui_flows.py::test_plan_management_flow - Assertio...
========================= 5 failed, 60 passed in 3.31s =========================
